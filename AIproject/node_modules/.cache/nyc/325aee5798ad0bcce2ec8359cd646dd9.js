var cov_idmd2e41v=function(){var path="/home/cong/study/fse/f18-ESN-SB2/controllers/credential.js",hash="69f33d9c1ad0f28fa3c919422fb7ae10d521d96c",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/cong/study/fse/f18-ESN-SB2/controllers/credential.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:38}},"1":{start:{line:2,column:17},end:{line:2,column:42}},"2":{start:{line:3,column:16},end:{line:3,column:43}},"3":{start:{line:5,column:16},end:{line:5,column:50}},"4":{start:{line:11,column:7},end:{line:11,column:15}},"5":{start:{line:15,column:17},end:{line:15,column:37}},"6":{start:{line:17,column:7},end:{line:19,column:10}},"7":{start:{line:18,column:8},end:{line:18,column:52}},"8":{start:{line:24,column:7},end:{line:26,column:10}},"9":{start:{line:25,column:11},end:{line:25,column:29}},"10":{start:{line:30,column:7},end:{line:32,column:10}},"11":{start:{line:31,column:11},end:{line:31,column:29}},"12":{start:{line:42,column:8},end:{line:46,column:11}},"13":{start:{line:52,column:18},end:{line:52,column:24}},"14":{start:{line:54,column:7},end:{line:59,column:10}},"15":{start:{line:63,column:7},end:{line:67,column:10}},"16":{start:{line:71,column:7},end:{line:75,column:10}},"17":{start:{line:79,column:0},end:{line:86,column:5}},"18":{start:{line:80,column:3},end:{line:82,column:4}},"19":{start:{line:81,column:7},end:{line:81,column:33}},"20":{start:{line:85,column:4},end:{line:85,column:20}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:10,column:3},end:{line:10,column:4}},loc:{start:{line:10,column:18},end:{line:12,column:4}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:3},end:{line:14,column:4}},loc:{start:{line:14,column:18},end:{line:21,column:4}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:17,column:14},end:{line:17,column:15}},loc:{start:{line:17,column:18},end:{line:19,column:8}},line:17},"3":{name:"(anonymous_3)",decl:{start:{line:23,column:3},end:{line:23,column:4}},loc:{start:{line:23,column:18},end:{line:27,column:4}},line:23},"4":{name:"(anonymous_4)",decl:{start:{line:24,column:66},end:{line:24,column:67}},loc:{start:{line:24,column:84},end:{line:26,column:8}},line:24},"5":{name:"(anonymous_5)",decl:{start:{line:29,column:3},end:{line:29,column:4}},loc:{start:{line:29,column:27},end:{line:33,column:4}},line:29},"6":{name:"(anonymous_6)",decl:{start:{line:30,column:70},end:{line:30,column:71}},loc:{start:{line:30,column:85},end:{line:32,column:8}},line:30},"7":{name:"(anonymous_7)",decl:{start:{line:41,column:4},end:{line:41,column:5}},loc:{start:{line:41,column:22},end:{line:47,column:5}},line:41},"8":{name:"(anonymous_8)",decl:{start:{line:42,column:47},end:{line:42,column:48}},loc:{start:{line:42,column:54},end:{line:46,column:9}},line:42},"9":{name:"(anonymous_9)",decl:{start:{line:49,column:3},end:{line:49,column:4}},loc:{start:{line:49,column:35},end:{line:60,column:4}},line:49},"10":{name:"(anonymous_10)",decl:{start:{line:54,column:85},end:{line:54,column:86}},loc:{start:{line:54,column:92},end:{line:59,column:8}},line:54},"11":{name:"(anonymous_11)",decl:{start:{line:62,column:3},end:{line:62,column:4}},loc:{start:{line:62,column:36},end:{line:68,column:4}},line:62},"12":{name:"(anonymous_12)",decl:{start:{line:63,column:69},end:{line:63,column:70}},loc:{start:{line:63,column:76},end:{line:67,column:8}},line:63},"13":{name:"(anonymous_13)",decl:{start:{line:70,column:3},end:{line:70,column:4}},loc:{start:{line:70,column:44},end:{line:76,column:4}},line:70},"14":{name:"(anonymous_14)",decl:{start:{line:71,column:74},end:{line:71,column:75}},loc:{start:{line:71,column:81},end:{line:75,column:8}},line:71},"15":{name:"(anonymous_15)",decl:{start:{line:79,column:18},end:{line:79,column:19}},loc:{start:{line:79,column:30},end:{line:86,column:1}},line:79}},branchMap:{"0":{loc:{start:{line:80,column:3},end:{line:82,column:4}},type:"if",locations:[{start:{line:80,column:3},end:{line:82,column:4}},{start:{line:80,column:3},end:{line:82,column:4}}],line:80}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},b:{"0":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const EventEmitter=(cov_idmd2e41v.s[0]++,require("events"));const mongoose=(cov_idmd2e41v.s[1]++,require('./db-connector'));const citizen=(cov_idmd2e41v.s[2]++,require('../model/Citizen'));const Citizen=(cov_idmd2e41v.s[3]++,mongoose.model('Citizen',citizen));let instance;class Citizens extends EventEmitter{constructor(){cov_idmd2e41v.f[0]++;cov_idmd2e41v.s[4]++;super();}push(citizen){cov_idmd2e41v.f[1]++;const a=(cov_idmd2e41v.s[5]++,new Citizen(citizen));cov_idmd2e41v.s[6]++;a.save(()=>{cov_idmd2e41v.f[2]++;cov_idmd2e41v.s[7]++;this.updateStatusToOnline(citizen.username);});}get(callback){cov_idmd2e41v.f[3]++;cov_idmd2e41v.s[8]++;Citizen.find({},null,{sort:{'userStatus':-1,'username':1}},(err,citizen)=>{cov_idmd2e41v.f[4]++;cov_idmd2e41v.s[9]++;callback(citizen);});}getActiveUser(callback){cov_idmd2e41v.f[5]++;cov_idmd2e41v.s[10]++;Citizen.find({userStatus:'Online'},null,{sort:{'username':1}},(err,Citizen)=>{cov_idmd2e41v.f[6]++;cov_idmd2e41v.s[11]++;callback(Citizen);});}//    getInActiveUser (callback){
//        Citizen.find({userStatus:'Offline'},(err,Citizen)=>{
//            callback(Citizen);
//        });
//    }
delete(loginname){cov_idmd2e41v.f[7]++;cov_idmd2e41v.s[12]++;Citizen.deleteOne({username:loginname},err=>{//    if(err){
//        console.log('db err');
//    }
cov_idmd2e41v.f[8]++;});}updateStatusToOnline(loginname){cov_idmd2e41v.f[9]++;//var condition = {userName:username};
//var update = {$set : {userStatus:'Online'}};
var date=(cov_idmd2e41v.s[13]++,Date());//console.log(date);
cov_idmd2e41v.s[14]++;Citizen.updateOne({username:loginname},{userStatus:'Online',lastLoginAt:date},err=>{//    if(err){
//     console.log("db err: can not update status");
//    }
cov_idmd2e41v.f[10]++;});}updateStatusToOffline(loginname){cov_idmd2e41v.f[11]++;cov_idmd2e41v.s[15]++;Citizen.updateOne({username:loginname},{userStatus:'Offline'},err=>{//    if(err){
//        console.log('db err');
//    }
cov_idmd2e41v.f[12]++;});}updateLastStatusCode(loginname,statusVal){cov_idmd2e41v.f[13]++;cov_idmd2e41v.s[16]++;Citizen.updateOne({username:loginname},{lastStatusCode:statusVal},err=>{//    if (err){
//        console.log("db err");
//    }
cov_idmd2e41v.f[14]++;});}}cov_idmd2e41v.s[17]++;module.exports=function(){cov_idmd2e41v.f[15]++;cov_idmd2e41v.s[18]++;if(!instance){cov_idmd2e41v.b[0][0]++;cov_idmd2e41v.s[19]++;instance=new Citizens();}else{cov_idmd2e41v.b[0][1]++;}cov_idmd2e41v.s[20]++;return instance;}();