var cov_1dosy0at9=function(){var path="/home/cong/study/fse/f18-ESN-SB2/controllers/chatPubliclyController.js",hash="6f5294b9c51ce79e57757c39753454acf4ef9036",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/cong/study/fse/f18-ESN-SB2/controllers/chatPubliclyController.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:32}},"1":{start:{line:2,column:13},end:{line:2,column:29}},"2":{start:{line:3,column:12},end:{line:3,column:21}},"3":{start:{line:4,column:15},end:{line:4,column:42}},"4":{start:{line:5,column:0},end:{line:5,column:34}},"5":{start:{line:6,column:17},end:{line:6,column:42}},"6":{start:{line:7,column:16},end:{line:7,column:43}},"7":{start:{line:8,column:16},end:{line:8,column:50}},"8":{start:{line:9,column:11},end:{line:9,column:26}},"9":{start:{line:10,column:17},end:{line:10,column:39}},"10":{start:{line:11,column:16},end:{line:11,column:43}},"11":{start:{line:12,column:11},end:{line:12,column:26}},"12":{start:{line:13,column:0},end:{line:13,column:16}},"13":{start:{line:16,column:0},end:{line:16,column:27}},"14":{start:{line:19,column:0},end:{line:57,column:1}},"15":{start:{line:20,column:2},end:{line:55,column:5}},"16":{start:{line:22,column:18},end:{line:22,column:29}},"17":{start:{line:23,column:17},end:{line:23,column:25}},"18":{start:{line:24,column:15},end:{line:24,column:23}},"19":{start:{line:25,column:19},end:{line:25,column:22}},"20":{start:{line:26,column:12},end:{line:26,column:22}},"21":{start:{line:27,column:19},end:{line:27,column:34}},"22":{start:{line:30,column:4},end:{line:53,column:9}},"23":{start:{line:33,column:8},end:{line:33,column:35}},"24":{start:{line:33,column:17},end:{line:33,column:35}},"25":{start:{line:35,column:8},end:{line:36,column:47}},"26":{start:{line:35,column:24},end:{line:35,column:40}},"27":{start:{line:36,column:13},end:{line:36,column:47}},"28":{start:{line:38,column:25},end:{line:46,column:10}},"29":{start:{line:49,column:8},end:{line:51,column:11}},"30":{start:{line:52,column:8},end:{line:52,column:25}},"31":{start:{line:59,column:0},end:{line:76,column:1}},"32":{start:{line:62,column:2},end:{line:74,column:5}},"33":{start:{line:63,column:4},end:{line:73,column:9}},"34":{start:{line:67,column:8},end:{line:67,column:36}},"35":{start:{line:67,column:17},end:{line:67,column:36}},"36":{start:{line:72,column:8},end:{line:72,column:42}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:19,column:25},end:{line:19,column:26}},loc:{start:{line:19,column:58},end:{line:57,column:1}},line:19},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:21},end:{line:20,column:22}},loc:{start:{line:20,column:42},end:{line:55,column:3}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:32,column:33},end:{line:32,column:34}},loc:{start:{line:32,column:54},end:{line:53,column:7}},line:32},"3":{name:"(anonymous_3)",decl:{start:{line:49,column:24},end:{line:49,column:25}},loc:{start:{line:49,column:39},end:{line:51,column:9}},line:49},"4":{name:"(anonymous_4)",decl:{start:{line:59,column:26},end:{line:59,column:27}},loc:{start:{line:59,column:38},end:{line:76,column:1}},line:59},"5":{name:"(anonymous_5)",decl:{start:{line:62,column:21},end:{line:62,column:22}},loc:{start:{line:62,column:42},end:{line:74,column:3}},line:62},"6":{name:"(anonymous_6)",decl:{start:{line:65,column:33},end:{line:65,column:34}},loc:{start:{line:65,column:58},end:{line:73,column:7}},line:65}},branchMap:{"0":{loc:{start:{line:33,column:8},end:{line:33,column:35}},type:"if",locations:[{start:{line:33,column:8},end:{line:33,column:35}},{start:{line:33,column:8},end:{line:33,column:35}}],line:33},"1":{loc:{start:{line:35,column:8},end:{line:36,column:47}},type:"if",locations:[{start:{line:35,column:8},end:{line:36,column:47}},{start:{line:35,column:8},end:{line:36,column:47}}],line:35},"2":{loc:{start:{line:67,column:8},end:{line:67,column:36}},type:"if",locations:[{start:{line:67,column:8},end:{line:67,column:36}},{start:{line:67,column:8},end:{line:67,column:36}}],line:67}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var express=(cov_1dosy0at9.s[0]++,require('express')),router=(cov_1dosy0at9.s[1]++,express.Router());const app=(cov_1dosy0at9.s[2]++,express());const server=(cov_1dosy0at9.s[3]++,require('http').Server(app));cov_1dosy0at9.s[4]++;io=require('socket.io')(server);const mongoose=(cov_1dosy0at9.s[5]++,require('./db-connector'));const citizen=(cov_1dosy0at9.s[6]++,require('../model/Citizen'));const Citizen=(cov_1dosy0at9.s[7]++,mongoose.model('Citizen',citizen));var path=(cov_1dosy0at9.s[8]++,require('path'));var bodyParser=(cov_1dosy0at9.s[9]++,require('body-parser'));const Message=(cov_1dosy0at9.s[10]++,require('../model/message'));var cors=(cov_1dosy0at9.s[11]++,require('cors'));cov_1dosy0at9.s[12]++;app.use(cors());// app.use(bodyParser.urlencoded({ extended: false }));
cov_1dosy0at9.s[13]++;app.use(bodyParser.json());// to support JSON-encoded bodies
//rest api to create a new message
cov_1dosy0at9.s[14]++;module.exports.message=function(bodyContent,bodyUser){cov_1dosy0at9.f[0]++;cov_1dosy0at9.s[15]++;return new Promise((resolve,reject)=>{cov_1dosy0at9.f[1]++;// router.post('/message', function (req, res) {
var content=(cov_1dosy0at9.s[16]++,bodyContent);var author=(cov_1dosy0at9.s[17]++,bodyUser);var type=(cov_1dosy0at9.s[18]++,"Public");var receiver=(cov_1dosy0at9.s[19]++,"-");var d=(cov_1dosy0at9.s[20]++,new Date());var postedAt=(cov_1dosy0at9.s[21]++,d.toISOString());// create a new user
cov_1dosy0at9.s[22]++;Citizen.find({}).where('username').equals(author).sort({postedAt:1}).exec(function(err,stat){cov_1dosy0at9.f[2]++;cov_1dosy0at9.s[23]++;if(err){cov_1dosy0at9.b[0][0]++;cov_1dosy0at9.s[24]++;return reject(err);}else{cov_1dosy0at9.b[0][1]++;}var tempStat;cov_1dosy0at9.s[25]++;if(stat==""){cov_1dosy0at9.b[1][0]++;cov_1dosy0at9.s[26]++;tempStat='Ok';}else{cov_1dosy0at9.b[1][1]++;cov_1dosy0at9.s[27]++;tempStat=stat[0].lastStatusCode;}// console.log(stat[0].lastStatusCode);
var newMessage=(cov_1dosy0at9.s[28]++,new Message({content:content,author:author,messageType:type,receiver:receiver,postedAt:postedAt,userStat:tempStat,wallId:"-"}));// save the message
cov_1dosy0at9.s[29]++;newMessage.save(function(err){// if (err) throw err;
cov_1dosy0at9.f[3]++;});cov_1dosy0at9.s[30]++;resolve(content);});});// });
};cov_1dosy0at9.s[31]++;module.exports.messages=function(){cov_1dosy0at9.f[4]++;cov_1dosy0at9.s[32]++;// app.get('/messages', function (req, res) {
// get all the users
return new Promise((resolve,reject)=>{cov_1dosy0at9.f[5]++;cov_1dosy0at9.s[33]++;Message.find({}).where('messageType').equals('Public').sort({postedAt:1}).exec(function(err,messages){cov_1dosy0at9.f[6]++;cov_1dosy0at9.s[34]++;// if (err) throw err;
if(err){cov_1dosy0at9.b[2][0]++;cov_1dosy0at9.s[35]++;return reject(err);}else{cov_1dosy0at9.b[2][1]++;}// object of all the users
// console.log(JSON.stringify(messages));
// res.end(JSON.stringify(messages));
cov_1dosy0at9.s[36]++;resolve(JSON.stringify(messages));});});// });
};// module.exports = router